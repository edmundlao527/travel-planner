<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¸…å–®</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",sans-serif;font-weight:800}
body{
  margin:0;
  background:radial-gradient(#eaeaea 1px,transparent 1px),radial-gradient(#f5f5f5 1px,transparent 1px);
  background-size:6px 6px;
  background-position:0 0,3px 3px;
}
header{padding:14px;text-align:center;font-size:20px}

.top-bar{
  display:flex;
  align-items:center;
  padding:10px;
}
.category-bar{
  flex:1;
  display:flex;
  justify-content:center;
  gap:10px;
  overflow-x:auto;
}
.cat-btn{
  min-width:90px;
  text-align:center;
  padding:10px;
  border:3px solid #000;
  background:#fff;
  box-shadow:4px 4px 0 #000;
  cursor:pointer;
}
.cat-btn.active{background:#ff8c00;color:#fff}

.filter{
  margin-left:auto;
}
select{
  padding:8px;
  border:3px solid #000;
  font-size:14px;
  background:#fff;
}

.list{padding:16px}

.item{
  display:flex;
  align-items:flex-start;
  gap:10px;
  margin-bottom:14px;
  padding:14px;
  border:3px solid #000;
  border-radius:14px;
  background:#fff;
  box-shadow:4px 4px 0 #000;
  cursor:pointer;
}
.item.done{opacity:.5}

.check{
  width:22px;
  height:22px;
  border:3px solid #000;
  cursor:pointer;
}

.name{font-size:16px}
.meta{font-size:13px;color:#444;margin-top:4px}

.add-btn{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  padding:14px;
  font-size:18px;
  border:3px solid #000;
  background:#ff8c00;
  color:#fff;
  box-shadow:5px 5px 0 #000;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-content{
  width:90%;
  background:#fff;
  border:3px solid #000;
  box-shadow:6px 6px 0 #000;
  padding:16px;
  position:relative;
}
.close{
  position:absolute;
  right:12px;
  top:8px;
  font-size:20px;
  cursor:pointer;
}

input,select,textarea{
  width:100%;
  margin-bottom:10px;
  padding:10px;
  border:3px solid #000;
  font-size:16px;
}

.action-row{display:flex;gap:10px}
.save{flex:1;padding:12px;border:3px solid #000;background:#000;color:#fff}
.delete{flex:1;padding:12px;border:3px solid #000;background:#fff}
</style>
</head>

<body>

<header>ðŸ§³ æ¸…å–®</header>

<div class="top-bar">
  <div class="category-bar" id="categoryBar"></div>
  <div class="filter">
    <select id="statusFilter" onchange="render()">
      <option value="all">å…¨éƒ¨</option>
      <option value="todo">æœªæº–å‚™</option>
      <option value="done">å·²æº–å‚™ / å·²è³¼è²·</option>
    </select>
  </div>
</div>

<div class="list" id="list"></div>

<button class="add-btn" onclick="openAdd()">ï¼‹ æ–°å¢žé …ç›®</button>

<!-- Modal -->
<div class="modal" id="modal" onclick="closeModal(event)">
  <div class="modal-content">
    <div class="close" onclick="hideModal()">âœ•</div>
    <input id="nameInput" placeholder="ç‰©å“åç¨±">
    <input id="categoryInput" placeholder="åˆ†é¡žï¼ˆä¾‹å¦‚ï¼šè¡ŒæŽã€è³¼ç‰©ï¼‰">
    <input id="qtyInput" type="number" placeholder="æ•¸é‡">
    <select id="unitInput">
      <option value="ä»¶">ä»¶</option>
      <option value="å€‹">å€‹</option>
      <option value="å¥—">å¥—</option>
      <option value="ç›’">ç›’</option>
    </select>
    <textarea id="noteInput" placeholder="å‚™è¨»"></textarea>
    <label><input type="checkbox" id="doneInput"> å·²æº–å‚™ / å·²è³¼è²·</label>
    <div class="action-row">
      <button class="save" onclick="save()">å„²å­˜</button>
      <button class="delete" onclick="remove()">åˆªé™¤</button>
    </div>
  </div>
</div>

<script>
/* Firebase */
firebase.initializeApp({
  apiKey:"AIzaSyASLSZHEKiQfUJU1c0sJ_9eH-6-9-1Rypc",
  authDomain:"tokyo-travel-share.firebaseapp.com",
  projectId:"tokyo-travel-share"
});
const db=firebase.firestore();

/* State */
let items=[],currentCat="å…¨éƒ¨",editId=null;

/* Listen */
db.collection("packing_items").orderBy("createdAt").onSnapshot(s=>{
  items=[];
  const cats=new Set(["å…¨éƒ¨"]);
  s.forEach(d=>{
    const data={id:d.id,...d.data()};
    items.push(data);
    cats.add(data.category);
  });
  buildCats([...cats]);
  render();
});

function buildCats(arr){
  const bar=document.getElementById("categoryBar");
  bar.innerHTML="";
  arr.forEach(c=>{
    const b=document.createElement("div");
    b.className="cat-btn"+(c===currentCat?" active":"");
    b.innerText=c;
    b.onclick=()=>{currentCat=c;buildCats(arr);render()};
    bar.appendChild(b);
  });
}

function render(){
  const wrap=document.getElementById("list");
  const f=document.getElementById("statusFilter").value;
  wrap.innerHTML="";
  items.filter(i=>{
    if(currentCat!=="å…¨éƒ¨"&&i.category!==currentCat)return false;
    if(f==="todo"&&i.done)return false;
    if(f==="done"&&!i.done)return false;
    return true;
  }).forEach(i=>{
    const d=document.createElement("div");
    d.className="item"+(i.done?" done":"");
    d.onclick=()=>openEdit(i);
    d.innerHTML=`
      <input type="checkbox" class="check" ${i.done?"checked":""}
        onclick="event.stopPropagation();toggle('${i.id}',this.checked)">
      <div>
        <div class="name">${i.name}</div>
        <div class="meta">${i.category}ï½œ${i.qty}${i.unit}</div>
        <div class="meta">${i.note||""}</div>
      </div>`;
    wrap.appendChild(d);
  });
}

/* CRUD */
function toggle(id,v){db.collection("packing_items").doc(id).update({done:v})}

function openAdd(){
  editId=null;
  nameInput.value=categoryInput.value=noteInput.value="";
  qtyInput.value=1;unitInput.value="ä»¶";doneInput.checked=false;
  modal.style.display="flex";
}
function openEdit(i){
  editId=i.id;
  nameInput.value=i.name;
  categoryInput.value=i.category;
  qtyInput.value=i.qty;
  unitInput.value=i.unit;
  noteInput.value=i.note;
  doneInput.checked=i.done;
  modal.style.display="flex";
}
function save(){
  const data={
    name:nameInput.value,
    category:categoryInput.value||"å…¶ä»–",
    qty:qtyInput.value,
    unit:unitInput.value,
    note:noteInput.value,
    done:doneInput.checked,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  };
  editId
    ?db.collection("packing_items").doc(editId).set(data)
    :db.collection("packing_items").add(data);
  hideModal();
}
function remove(){
  if(editId)db.collection("packing_items").doc(editId).delete();
  hideModal();
}
function hideModal(){modal.style.display="none"}
function closeModal(e){if(e.target.id==="modal")hideModal()}
</script>

</body>
</html>
