<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ—…éŠæ¸…å–® - æ—…éŠåŠ©æ‰‹</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* ===== å»¶ç”¨èƒŒæ™¯ä¿®å¾©æ–¹æ³• ===== */
* { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif; font-weight: 800; -webkit-tap-highlight-color: transparent; }

html, body { margin: 0; height: 100%; overflow: hidden; }

.main-container {
  height: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch;
  padding-bottom: 120px; position: relative; z-index: 1;
}

.bg-fixed {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-image: url('images/checklist/checklistbg.jpeg');
  background-size: cover; background-position: center; z-index: -1;
}

header { 
  padding: 16px; text-align: center; font-size: 20px; border-bottom: 3px solid #000; 
  background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
}

/* åˆ†é¡åˆ‡æ› (Tabs) */
.tab-scroll {
  display: flex; overflow-x: auto; gap: 10px; padding: 15px;
  background: rgba(255,255,255,0.7); border-bottom: 3px solid #000;
  scrollbar-width: none; /* éš±è—æ²å‹•æ¢ */
}
.tab-scroll::-webkit-scrollbar { display: none; }

.tab {
  flex-shrink: 0; padding: 8px 16px; border: 3px solid #000;
  background: #fff; box-shadow: 3px 3px 0 #000; font-size: 14px;
}
.tab.active { background: #ff8c00; color: #fff; }

/* æ¸…å–®æ¨£å¼ */
.checklist { padding: 20px; }

.item-card {
  display: flex; align-items: center; gap: 12px;
  background: #fff; border: 3px solid #000; box-shadow: 4px 4px 0 #000;
  padding: 15px; margin-bottom: 15px; border-radius: 12px;
}
.item-card.checked { opacity: 0.6; }
.item-card.checked .item-text { text-decoration: line-through; }

.checkbox {
  width: 28px; height: 28px; border: 3px solid #000; 
  display: flex; align-items: center; justify-content: center; background: #fff;
}
.item-card.checked .checkbox { background: #bbf7d0; }
.item-card.checked .checkbox::after { content: 'âœ“'; color: #000; }

.item-text { flex: 1; font-size: 16px; }

.delete-x { color: #ff4444; font-size: 18px; padding-left: 10px; }

/* æ‡¸æµ®æŒ‰éˆ• */
.add-fab { 
  position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px; 
  background: #ff8c00; border: 4px solid #000; border-radius: 50%; 
  box-shadow: 5px 5px 0 #000; display: flex; align-items: center; justify-content: center; 
  font-size: 32px; color: #fff; z-index: 100; 
}

/* Modal */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
.modal-content { width: 100%; max-width: 350px; background: #fff; border: 4px solid #000; box-shadow: 8px 8px 0 #000; padding: 20px; }
input { width: 100%; border: 3px solid #000; padding: 12px; margin-top: 10px; font-size: 16px; font-weight: 800; }
.save-btn { width: 100%; padding: 12px; background: #000; color: #fff; border: 3px solid #000; margin-top: 15px; }
</style>
</head>

<body>

<div class="bg-fixed"></div>

<div class="main-container">
  <header>ğŸ—‚ï¸ æ—…éŠæ¸…å–®</header>

  <div class="tab-scroll">
    <div class="tab active" onclick="switchTab('inventory', this)">ğŸ  å®¶ä¸­å­˜è²¨</div>
    <div class="tab" onclick="switchTab('packing', this)">ğŸ“¦ è¡Œææª¢æŸ¥</div>
    <div class="tab" onclick="switchTab('shopping', this)">ğŸ›’ è³¼ç‰©æ¸…å–®</div>
    <div class="tab" onclick="switchTab('todo', this)">ğŸ“ å¾…è¾¦äº‹é …</div>
  </div>

  <div class="checklist" id="checklist">
    </div>
</div>

<div class="add-fab" onclick="openAddModal()">ï¼‹</div>

<div class="modal" id="addModal" onclick="if(event.target==this) closeAddModal()">
  <div class="modal-content">
    <h3 style="margin-top:0">æ–°å¢é …ç›®</h3>
    <input type="text" id="newItemInput" placeholder="è¼¸å…¥ç‰©å“æˆ–äº‹é …...">
    <button class="save-btn" onclick="addItem()">åŠ å…¥æ¸…å–®</button>
  </div>
</div>

<script>
/* Firebase é…ç½® */
const firebaseConfig = { apiKey: "AIzaSyASLSZHEKiQfUJU1c0sJ_9eH-6-9-1Rypc", authDomain: "tokyo-travel-share.firebaseapp.com", projectId: "tokyo-travel-share" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentTab = 'inventory';
let allItems = [];

/* åˆå§‹åŒ–èˆ‡è¼‰å…¥ */
function switchTab(tab, el) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderList();
}

db.collection("checklists").onSnapshot(s => {
  allItems = [];
  s.forEach(doc => allItems.push({ id: doc.id, ...doc.data() }));
  renderList();
});

function renderList() {
  const listEl = document.getElementById('checklist');
  listEl.innerHTML = "";
  
  const filtered = allItems.filter(item => item.type === currentTab);
  
  filtered.forEach(item => {
    listEl.innerHTML += `
      <div class="item-card ${item.done ? 'checked' : ''}" onclick="toggleItem('${item.id}', ${item.done})">
        <div class="checkbox"></div>
        <div class="item-text">${item.text}</div>
        <div class="delete-x" onclick="event.stopPropagation();deleteItem('${item.id}')">âœ•</div>
      </div>`;
  });
}

/* æ“ä½œå‡½æ•¸ */
function openAddModal() { document.getElementById('addModal').style.display = 'flex'; newItemInput.focus(); }
function closeAddModal() { document.getElementById('addModal').style.display = 'none'; }

function addItem() {
  const text = document.getElementById('newItemInput').value;
  if(!text) return;
  db.collection("checklists").add({
    text: text,
    type: currentTab,
    done: false,
    createdAt: Date.now()
  }).then(() => {
    document.getElementById('newItemInput').value = "";
    closeAddModal();
  });
}

function toggleItem(id, currentStatus) {
  db.collection("checklists").doc(id).update({ done: !currentStatus });
}

function deleteItem(id) {
  if(confirm("ç¢ºå®šåˆªé™¤æ­¤é …ç›®ï¼Ÿ")) db.collection("checklists").doc(id).delete();
}

/* èƒŒæ™¯é«˜åº¦é–å®š */
function fixHeight() {
  document.querySelector('.bg-fixed').style.height = window.innerHeight + 'px';
}
window.addEventListener('load', fixHeight);
window.addEventListener('resize', fixHeight);
</script>
</body>
</html>
