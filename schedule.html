<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¡Œç¨‹è¡¨ Firebase åŒæ­¥ç‰ˆ</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
* { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif; font-weight: 800; }
body { margin:0; background: radial-gradient(#eaeaea 1px, transparent 1px), radial-gradient(#f5f5f5 1px, transparent 1px); background-size: 6px 6px; background-position: 0 0, 3px 3px; }
header { padding: 14px; text-align:center; font-size:20px; }

body {
 position: relative;
  min-height: 100vh;
}

body::before {
  content: "";
  position: absolute;   /* â† é—œéµ */
  inset: 0;
  background-image: url("images/schedulebg.jpeg");
  background-repeat: no-repeat;
  background-position: center bottom;
  background-size: cover;
  opacity: 0.8;
  z-index: -1;
}

/* å¦‚æœæƒ³å…¼å®¹æ‰‹æ©ŸæŸäº›ç€è¦½å™¨ä¸æ”¯æŒ fixedï¼Œå¯ä»¥åŠ ä¸€å€‹ fallback */
@supports (-webkit-overflow-scrolling: touch) {
  body::before {
    background-attachment: scroll;
  }
}


/* ===== æ—¥æœŸé¸å–® ===== */
.date-bar {
  display: flex;
  gap: 10px;
  padding: 10px;
  overflow-x: auto;
  white-space: nowrap;
  -webkit-overflow-scrolling: touch;
}
.date-btn { 
  min-width:90px; 
  text-align:center; 
  padding:10px; 
  border:3px solid #000; 
  background:#fff; 
  box-shadow:4px 4px 0 #000; 
  cursor:pointer; 
}
.date-btn.active { background:#ff8c00; color:#fff; }

/* ===== Timeline & Event Card ===== */
.timeline {
  position: relative;
  padding: 16px 10px 140px; /* é ç•™ä¸‹æ–¹ç©ºé–“çµ¦æ–°å¢æŒ‰éˆ• */
}
.timeline::before {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  left: 50%;
  width: 4px;
  background: #000;
  transform: translateX(-50%);
}
.event {
  position: relative;
  width: calc(50% - 30px);
  margin-bottom: 40px;
  padding: 16px;
  border: 3px solid #000;
  border-radius: 16px;
  background: #fff;
  box-shadow: 4px 4px 0 #000;
  word-break: break-word;
}
.event.left { margin-left: 0; margin-right: auto; }
.event.right { margin-left: auto; margin-right: 0; }
.event:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 #000; }
.event-wrapper {
  position: relative;
  margin-bottom: 40px; /* å¡ç‰‡é–“è· */
}

.event.center {
  margin-left: auto;
  margin-right: auto;
  width: 55%; /* æˆ–ä½ å¸Œæœ›çš„å¯¬åº¦ */
  text-align: right; /* å¡ç‰‡å…§å®¹ç½®ä¸­ */
}


.event-type {
  display: inline-block;
  margin-bottom: 6px;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 900;
  border-radius: 999px;
  border: 2px solid #000;
  box-shadow: 2px 2px 0 #000;
  text-transform: capitalize;
}
.event-type.hotel { background: #dbeafe; }
.event-type.food { background: #fde68a; }
.event-type.shopping { background: #fbcfe8; }
.event-type.spot { background: #bbf7d0; }
.event-type.transport { background: #a5b4fc; } /* æ·¡ç´« */
.event-type.plan { background: #fef08a; }   


.event-title, .event-place, .event-note {
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
}

.event-title { font-size: 18px; font-weight: 900; line-height: 1.3; }
.event-place { font-size: 14px; margin-top: 4px; color:#333; }
.event-note { font-size: 13px; margin-top: 6px; color:#666; line-height:1.4; }

/* ===== æ™‚é–“åœ“é» ===== */
.time-dot {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 52px;
  height: 52px;
  background: #ff8c00;
  border: 3px solid #000;
  border-radius: 50%;
  color: #fff;
  font-size: 16px;
  font-weight: 900;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 3px 3px 0 #000;
}

.time-dot-inside {
  position: absolute;
  left: 8px;          /* è·é›¢å¡ç‰‡å·¦é‚Š */
  top: 50%;
  transform: translateY(-50%);
  width: 48px;
  height: 48px;
  background: #ff8c00;
  border: 3px solid #000;
  border-radius: 50%;
  color: #fff;
  font-size: 12px;
  font-weight: 900;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 2px 2px 0 #000;
}


/* è©³ç´° Modal ç·¨è¼¯æŒ‰éˆ• */
.edit-detail-btn {
  position: absolute;   /* ç›¸å°æ–¼ modal-content */
  top: 8px;
  right: 8px;
  padding: 6px 10px;
  font-size: 14px;
  font-weight: 900;
  border: 2px solid #000;
  background: #fff;
  cursor: pointer;
  box-shadow: 2px 2px 0 #000;
  z-index: 2;           /* ç¢ºä¿åœ¨å…§å®¹ä¸Šæ–¹ */
}


/* ===== Modal & Form ===== */
.add-btn { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); width:90%; padding:14px; font-size:18px; border:3px solid #000; background:#ff8c00; color:#fff; box-shadow:5px 5px 0 #000; }
.modal { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:none; align-items:center; justify-content:center; }
.modal-content { width:90%; background:#fff; border:3px solid #000; box-shadow:6px 6px 0 #000; padding:16px; }
.modal-content h3 { margin-top:0; }
input, textarea, select { width:100%; margin-bottom:10px; padding:10px; border:3px solid #000; font-size:16px; font-weight:800; background:#fff; }
.action-row { display:flex; gap:10px; }
.save-btn { flex:1; padding:12px; border:3px solid #000; background:#000; color:#fff; }
.delete-btn { flex:1; padding:12px; border:3px solid #000; background:#fff; color:#000; }

</style>
</head>
<body>

<header>ğŸ“… è¡Œç¨‹è¡¨</header>
<div class="date-bar" id="dateBar"></div>
<div class="timeline" id="timeline">
  <div class="event-wrapper">
    <div class="time-dot">08:00</div>
    <div class="event right">
      <div class="event-type hotel">é…’åº—</div>
      <div class="event-title">æ—©é¤</div>
      <div class="event-place">é£¯åº—å¤§å»³</div>
      <div class="event-note">æº–å‚™è¡Œæ</div>
    </div>
  </div>
</div>

<button class="add-btn" onclick="openAdd()">ï¼‹ æ–°å¢è¡Œç¨‹</button>

<!-- Modal -->
<div class="modal" id="modal" onclick="closeModal(event)">
  <div class="modal-content">
    <h3 id="modalTitle">æ–°å¢è¡Œç¨‹</h3>
    <select id="typeInput">
      <option value="">é¸æ“‡é¡å‹</option>
	  <option value="plan">è¡Œç¨‹</option>
      <option value="transport">äº¤é€š</option>
      <option value="food">é£²é£Ÿ</option>
      <option value="shopping">è³¼ç‰©</option>
	  <option value="hotel">é…’åº—</option>
      <option value="spot">æ™¯é»</option>
    </select>
    <input id="titleInput" placeholder="è¡Œç¨‹">
    <input id="timeInput" type="time" placeholder="æ™‚é–“">
    <input id="placeInput" placeholder="åœ°é»">
    <textarea id="noteInput" placeholder="å‚™è¨»"></textarea>
    <div class="action-row">
      <button class="save-btn" onclick="save()">å„²å­˜</button>
      <button class="delete-btn" onclick="remove()">åˆªé™¤</button>
    </div>
  </div>
</div>

<div class="modal" id="detailModal" onclick="closeDetailModal(event)">
  <div class="modal-content">
    <!-- ç·¨è¼¯æŒ‰éˆ•æ”¾åœ¨ Modal å…§å®¹å³ä¸Šè§’ -->
    <button class="edit-detail-btn" onclick="editFromDetail(event)">ç·¨è¼¯</button>
    
    <h3 id="detailTitle"></h3>
    <p><strong>é¡å‹ï¼š</strong><span id="detailType"></span></p>
    <p><strong>æ™‚é–“ï¼š</strong><span id="detailTime"></span></p>
    <p><strong>åœ°é»ï¼š</strong><span id="detailPlace"></span></p>
    <p><strong>å‚™è¨»ï¼š</strong><span id="detailNote"></span></p>
  </div>
</div>



<script>

/* ===== Firebase åˆå§‹åŒ– ===== */
const firebaseConfig = {
  apiKey: "AIzaSyASLSZHEKiQfUJU1c0sJ_9eH-6-9-1Rypc",
  authDomain: "tokyo-travel-share.firebaseapp.com",
  projectId: "tokyo-travel-share",
  storageBucket: "tokyo-travel-share.firebasestorage.app",
  messagingSenderId: "199301658742",
  appId: "1:199301658742:web:81dec31fd424e73e598757"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ===== æ—¥æœŸé¸å–® ===== */
const dates = ["02/15","02/16","02/17","02/18","02/19","02/20","02/21","02/22","02/23"];
let currentDate = dates[0];
let editId = null;

const dateBar = document.getElementById("dateBar");
dates.forEach(d=>{
  const b = document.createElement("div");
  b.className="date-btn";
  b.innerText=d;
  b.onclick=()=>selectDate(d);
  dateBar.appendChild(b);
});

/* ===== Firestore ç›£è½ ===== */
let unsubscribe = null;
selectDate(currentDate);

function selectDate(d){
  currentDate=d;
  document.querySelectorAll(".date-btn").forEach(b=>{
    const isActive = b.innerText===d;
    b.classList.toggle("active", isActive);
    if(isActive) b.scrollIntoView({behavior:"smooth", inline:"center", block:"nearest"});
  });
  subscribeToEvents(d);
}

function subscribeToEvents(date){
  if(unsubscribe) unsubscribe();
  unsubscribe = db.collection("events")
    .where("date","==",date)
    .orderBy("time")
    .onSnapshot(snapshot=>{
      const arr=[];
      snapshot.forEach(doc=>arr.push({id:doc.id,...doc.data()}));
      render(arr);
    });
}

/* ===== Render ===== */
function render(eventsArray) {
  const t = document.getElementById("timeline");
  t.innerHTML = ""; // æ¸…ç©º

  eventsArray.forEach(e => {
    let side;
    if(e.type === "shopping" || e.type === "spot") side = "left";
    else if(e.type === "itinerary") side = "left";
    else if(e.type === "transport") side = "center";
    else side = "right";

    const div = document.createElement("div");
    div.className = `event ${side}`;
    // æ–°è¡Œï¼šé»æ“Šé¡¯ç¤ºè©³ç´° Modal
    div.onclick = () => openDetail(e);

    // å¡ç‰‡å…§å®¹åªé¡¯ç¤ºé¡å‹å’Œæ¨™é¡Œ
    div.innerHTML = `
      <div class="event-type ${e.type}">${e.type}</div>
      <div class="event-title">${e.title}</div>
      ${e.type === "transport" ? `<div class="time-dot-inside">${e.time}</div>` : ``}
    `;
    t.appendChild(div);

    // éäº¤é€šé¡å‹ï¼Œæ™‚é–“åœ“é»æµ®åœ¨ä¸­ç·š
    if(e.type !== "transport") {
      const dot = document.createElement("div");
      dot.className = "time-dot";
      dot.innerText = e.time;
      const cardTop = div.offsetTop;
      const cardHeight = div.offsetHeight;
      dot.style.top = `${cardTop + cardHeight/2 - 24}px`;
      t.appendChild(dot);
    }
  });
}

const detailModal = document.getElementById("detailModal");
let currentDetailId = null; // ç´€éŒ„ç›®å‰è©³ç´°è¡Œç¨‹ ID

function openDetail(e){
  currentDetailId = e.id;
  document.getElementById("detailTitle").innerText = e.title;
  document.getElementById("detailType").innerText = e.type;
  document.getElementById("detailTime").innerText = e.time || "";
  document.getElementById("detailPlace").innerText = e.place || "";
  document.getElementById("detailNote").innerText = e.note || "";
  detailModal.style.display = "flex";
}

function closeDetailModal(ev){
  if(ev.target.id === "detailModal") detailModal.style.display = "none";
}

// å¾è©³ç´° Modal é»ç·¨è¼¯
function editFromDetail(ev){
  ev.stopPropagation();  // é˜²æ­¢é»æ“ŠæŒ‰éˆ•æ™‚è§¸ç™¼ Modal é—œé–‰
  detailModal.style.display = "none";
  if(currentDetailId){
    db.collection("events").doc(currentDetailId).get().then(doc=>{
      if(doc.exists){
        openEdit(doc.id, doc.data());
      }
    });
  }
}


/* ===== Modal æ“ä½œ ===== */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const timeInput = document.getElementById("timeInput");
const titleInput = document.getElementById("titleInput");
const placeInput = document.getElementById("placeInput");
const noteInput = document.getElementById("noteInput");
const typeInput = document.getElementById("typeInput");

function openAdd(){
  editId=null;
  modalTitle.innerText="æ–°å¢è¡Œç¨‹";
  timeInput.value=titleInput.value=placeInput.value=noteInput.value="";
  typeInput.value="";
  modal.style.display="flex";
}

function openEdit(id,data){
  editId=id;
  modalTitle.innerText="ç·¨è¼¯è¡Œç¨‹";
  timeInput.value = data.time || "";
  titleInput.value = data.title || "";
  placeInput.value = data.place || "";
  noteInput.value = data.note || "";
  typeInput.value = data.type || "";
  modal.style.display="flex";
}

function save(){
  const e = {
    date: currentDate,
    time: timeInput.value,
    title: titleInput.value,
    place: placeInput.value,
    note: noteInput.value,
    type: typeInput.value,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  if(editId){
    db.collection("events").doc(editId).set(e);
  } else {
    db.collection("events").add(e);
  }
  modal.style.display="none";
}

function remove(){
  if(editId){
    db.collection("events").doc(editId).delete();
    modal.style.display="none";
  }
}

function closeModal(ev){
  if(ev.target.id==="modal") modal.style.display="none";
}
</script>

</body>
</html>






